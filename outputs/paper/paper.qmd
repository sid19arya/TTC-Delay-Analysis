---
title: "Have public transport delays in Toronto gotten worse over time? An analysis of the TTC street car delays"
# subtitle: "My subtitle if needed"
author: 
  - Siddharth Arya
thanks: "Code and data are available at: https://github.com/sid19arya/TTC-Delay-Analysis.git"
date: today
date-format: long
abstract: "The Toronto Transit Commission (TTC) has been a core part of all residents of the city for decades - keeping each part of the city connected. That being said, the TTC is under constant scrutiny and criticism, especially in recent years regarding delays worsening - inconveniencing people's commutes. This paper examines the TTC Delays, using data from OpenDataToronto, and disproves the notion that delays have been getting increasingly worse over the past few years."
format: pdf
toc: true
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(here)
library(knitr)
library(kableExtra)
analysis_data <- read_csv(here("outputs/data/analysis_data.csv"))
analysis_data$Date <- factor(analysis_data$Date, levels = unique(analysis_data$Date))
raw_data_ex <- read_csv(here("inputs/data/raw_data_2021.csv"))

```









# Introduction

As the COVID-19 pandemic died down, riders returned to the TTC, making the public transit around the city active once more. However, with their return came rampant criticism about the delays regarding the TTC. Pseudo-studies claim confidently that the TTC is deteriorating as time passes (sources) and adding to the commutes of residents of the city. 

However, these are empty claims yet to be strongly supported or disproved. This study looks more closely at TTC data - specifically at streetcar delays, to reveal wether these claims are truly founded or not.

This paper is organized in the following sections: Data, Results, Conclusion… 


# Data {#sec-data}

The data utilized in this paper is from OpenDataToronto Library, the Data sets used are entitled: “TTC-Streetcar-Delays”. This dataset was last updated January 18, 2024 - and contains a detailed report of each streetcar delay from 2013 through to 2023. For the purposes of this paper, we will only examine data from 2021 on wards - as we are focused on post-pandemic trends in streetcar delays. The data was collected, sorted and analyzed through the help of … (Cite all the packages).[@citeR] 

## Features of the Data

From the source, three individual datasets were gathered, for the delays from the years 2021, 2022, and 2023. Each of these datasets have the same 10 variable columns, and the number of observations they include range from 14400 to 17700. Each observation contains information about the the time, location, reason, and cause of each and every streetcar delay. 

The data in its raw form includes all these values (@tabl-raw)

```{r}
#| echo: false
#| label: tabl-raw
#| message: false
#| warning: false
#| tbl-cap: "Sample of uncleaned TTC Delay Data"
table_raw <- kable(head(raw_data_ex)) %>% 
  kable_styling(full_width = FALSE) %>% 
  kable_styling(
      latex_options = c("hold_position"),
      full_width = FALSE
    ) %>%
    column_spec(column = 1:ncol(raw_data_ex), width = "2cm")

table_raw2 <- kable(head(raw_data_ex),
  escape = FALSE) %>%
  kable_styling(
    full_width = FALSE,  # Set to FALSE to limit width
    bootstrap_options = "striped",  # Add striped rows for better readability
    latex_options = c("hold_position")  # Use LaTeX options
  ) %>%
  row_spec(0, bold = TRUE)  # Bold the header row


table_raw2
```

## Cleaning the Data

For cleaning the data, we apply simple steps to organize and summarise information from the three similar datasets, and aggregate their information. First, we drop rows that lacked any information (some columns indicated 'N/A' perhaps due to human error in logging the incident). Next we changed the Date/time of the incidents into a format more appropriate for our use-case ('mm/yyyy'). Finally, we aggregate over each of the incidents, and grouping by month, we create a count for the number of incidents in that month, as well as the total number of minutes delayed (summing the min_delay column from the inital dataset). We then concatonate the three datasets together. Additionally, after concatonating we also added a months elasped (from Jan 2021) column, this is because a numberical representation of passing time helps in visualizing the data, and calculating the correlation between factors. 

A sample of the clean data is shown in table (@tabl-clean).


```{r}
#| label: tabl-clean
#| echo: false
#| message: false
#| warning: false
#| tbl-cap: "Sample of Cleaned TTC Delay Data"
table <- kable(head(analysis_data)) %>% 
  kable_styling(full_width = FALSE)

table 
```

## Visualizing the data


From the clean data, we contain simple visual representations of the number of incidents, and total delay across months in figures 1(@incidents-hist) and 2(@delay-hist) respectively.



```{r fig.height=3}
#| label: incidents-hist
#| fig-cap: "Number of Delay Incidents accross months"
#| fig-align: 'center'
#| echo: false
#| warning: false

# Note for clarify: The scale_x_discrete code just makes it so the labels for only some of the bars are included, so that the label does not look too clutered!

ggplot(analysis_data, aes(Date, incidents)) +
  geom_col()+
  scale_x_discrete(labels = c("","","","","05/21","","","","","10/21","","",
          "","","","","05/22","","","","","10/22","","",
          "","","","","05/23","","","","","10/23","","")) + 
  coord_flip()

```

```{r fig.height=3}
#| label: delay-hist
#| fig-cap: "Total Delay (in minutes) accross months"
#| fig-align: 'center'
#| echo: false
#| warning: false

# Note for clarify: The scale_x_discrete code just makes it so the labels for only some of the bars are included, so that the label does not look too clutered!

ggplot(analysis_data, aes(Date, total_delay)) +
  geom_col() +
  coord_flip() + 
  scale_x_discrete(limits = rev(levels(analysis_data$Date)), labels = c("","","","","05/21","","","","","10/21","","",
          "","","","","05/22","","","","","10/22","","",
          "","","","","05/23","","","","","10/23","",""))

```


# Results

Upon an initial rough visual inspection of the histograms, granting some amount of variance, neither the number of incidents nor the total delay seem to show notable growth. However, further investigation indicates differently. Figures 3(@inc_plot) and 4(@delay_plot) show the same data displayed as scatter plots, with a line of best fit to indicate any correlation. Although the number incidents are. This claim is given further validity when examine the correlation coefficient (R) values calculated for the two pairs of variables. The R values were -0.0016 and 0.3881 for the correlation of months elapsed with incident count and total delay respectively. The correlation coefficient of -0.0016 is negligible and therefore cannot be used to draw any indication that the number of streetcar delays incidents has increased the past 3 years. On the other hand, a correlation coefficient of 0.3881 between the total delay in minutes and months elapsed does seem to indicate a small but notably postie correlation between the two variables. Thus we see some support to the claim that the amount of delay faced by TTC riders has shown steady increase in the past 3 years.




```{r}
#| label: inc_plot
#| fig-cap: "Incidents across months (elasped from Jan/2021), with line of best fit"
#| fig-align: 'center'
#| echo: false
#| warning: false

ggplot(analysis_data, aes(x = months_elapsed, y = incidents)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") # Add a line of best fit
```



```{r}
#| label: delay_plot
#| fig-cap: "Total_delay (in minutes) across months (elasped from Jan/2021), with line of best fit"
#| fig-align: 'center'
#| echo: false
#| warning: false
ggplot(analysis_data, aes(x = months_elapsed, y = total_delay)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") # Add a line of best fit

```
```{r}
#| echo: false

# Although the raw input of this code is not included, this was the code used to calcualte the R values for the two pairs of variables. 
incidents_correlation <- cor(analysis_data$months_elapsed, analysis_data$incidents)
delay_correlation <- cor(analysis_data$months_elapsed, analysis_data$total_delay)
print(paste("Incidents_Correlation (R value):", incidents_correlation))
print(paste("Delay_Correlation (R value):", delay_correlation))

```




# Discussion

- mainly that correlation can be explained for many reasons. Critism show that the ttc is just bad, further investigation might observe many people have just been returning more and more, and more use of the ttc causes more delay incidents or whatnot. 

# Conclusion

This paper investigated TTC delays spanning the years 2021, 2022, 2023 to see if a trend over time could be spotted. The paper concluded that there was no noticeable 





\newpage




# References


